# 🎮 통합 로스트아크 디스코드 봇

로스트아크 떠돌이상인 알림과 캐릭터 정보 조회를 제공하는 통합 디스코드 봇입니다.

## 🌟 주요 기능

### 🚨 **스마트 떠상 알림**
- **데이터 변경 감지**: 상인 정보가 실제로 변경될 때만 알림 전송
- **다중 서버 지원**: 여러 서버에서 동시 사용 가능
- **서버별 독립 설정**: 각 서버마다 원하는 채널에 알림 설정
- **실시간 모니터링**: 5분마다 자동 체크

### ⚔️ **캐릭터 정보 조회**
- **개별 캐릭터 조회**: `/캐릭터정보` 명령어로 특정 캐릭터 정보 확인
- **원정대 정보 조회**: `/원정대정보` 명령어로 전체 원정대 캐릭터 목록
- **서버별 그룹핑**: 원정대 캐릭터를 서버별로 정리해서 표시
- **로스트아크 공식 API**: 정확하고 최신 데이터 제공

### 🎯 **정확한 데이터**
- **Selenium 기반**: 실시간 웹 데이터 수집
- **아이템 등급 표시**: 이모지로 등급별 색상 구분
- **서버 필터링**: 원하는 서버 데이터만 수집

## 🚀 설치 및 실행

### 1. 필수 요구사항
```bash
pip install -r requirements.txt
```

### 2. Chrome Driver 설치
- [ChromeDriver 다운로드](https://chromedriver.chromium.org/)
- PATH에 추가하거나 프로젝트 폴더에 배치

### 3. 봇 실행
```bash
python integrated_lostark_bot.py
```

### 4. 설정 입력
- **Discord 봇 토큰**: 필수
- **로스트아크 API 키**: 선택사항 (캐릭터 정보 조회용)

## 📋 사용법

### 🔧 **초기 설정**
1. 봇을 서버에 초대
2. 알림을 받고 싶은 채널에서 `/알림설정` 명령어 사용 (관리자 권한 필요)
3. 설정 완료 후 자동 알림 시작

### 💬 **슬래시 명령어**

#### 📍 **떠돌이상인 명령어**
- `/떠상` - 현재 활성 떠돌이 상인 조회
- `/새로고침` - 데이터 수동 새로고침
- `/떠상검색 아이템명` - 특정 아이템으로 상인 검색

#### 🔔 **알림 설정 명령어**
- `/알림설정` - 현재 채널을 알림 채널로 설정 (관리자)
- `/알림해제` - 자동 알림 해제 (관리자)
- `/알림상태` - 알림 설정 상태 확인

#### ⚔️ **캐릭터 정보 명령어**
- `/캐릭터정보 캐릭터명` - 특정 캐릭터 정보 조회
- `/원정대정보 캐릭터명` - 원정대 전체 캐릭터 조회

#### 🛠️ **기타 명령어**
- `/도움말` - 전체 명령어 및 사용법 안내
- `/동기화` - 슬래시 명령어 강제 동기화 (개발자용)

## 🎨 아이템 등급 표시

| 등급 | 이모지 | RGB 색상 |
|------|--------|----------|
| 일반 | ⚪ | 하얀색 |
| 고급 | 🟢 | RGB(147,188,70) |
| 희귀 | 🔵 | RGB(42,177,246) |
| 영웅 | 🟣 | RGB(128,69,221) |
| 전설 | 🟠 | RGB(249,174,0) |

## ⏰ 떠상 시간표

| 시간대 | 상태 |
|--------|------|
| 04:00 ~ 09:30 | 🟢 활성 |
| 10:00 ~ 15:30 | 🟢 활성 |
| 16:00 ~ 21:30 | 🟢 활성 |
| 22:00 ~ 03:30 | 🟢 활성 |
| 기타 시간 | 🔴 비활성 |

## 🛠️ 기술 스택

- **Python 3.8+**
- **Discord.py** - 디스코드 봇 API (슬래시 명령어)
- **Selenium** - 웹 자동화 및 데이터 수집
- **BeautifulSoup4** - HTML 파싱
- **Requests** - HTTP 요청 및 로스트아크 API 호출

## 📁 주요 파일 설명

### 🤖 **메인 봇 파일**
- `integrated_lostark_bot.py` - **통합 로스트아크 봇** (최신, 권장)
- `selenium_merchant_fetcher.py` - Selenium 기반 떠상봇
- `ninav_dynamic_bot.py` - 니나브 서버 전용 동적 데이터 봇

### 📊 **분석 및 테스트**
- `analyze_merchant_data.py` - 상인 데이터 분석
- `test_default_items.py` - 기본 아이템 테스트
- `verify_current_data.py` - 현재 데이터 검증

### 📚 **문서**
- `README_상인봇_사용법.md` - 상인봇 사용법
- `README_실시간_떠상봇.md` - 실시간 떠상봇 가이드
- `README_완전체_사용법.md` - 완전체 사용법
- `INSTALL.md` - 설치 가이드

## 🔧 고급 설정

### 로스트아크 API 설정
```python
# API 키 발급: https://developer-lostark.game.onstove.com/
LOSTARK_API_KEY = "your_api_key_here"
```

### Chrome 옵션
```python
chrome_options.add_argument('--headless')  # 브라우저 창 숨기기
chrome_options.add_argument('--no-sandbox')
chrome_options.add_argument('--disable-dev-shm-usage')
```

## 📈 데이터 구조

### 떠돌이상인 데이터
```python
{
    'region_name': '유디아',
    'npc_name': '루카스',
    'items': [
        {
            'name': '모리나',
            'type': 1,  # 1=카드, 2=호감도, 3=특수
            'grade': '희귀',
            'hidden': False
        }
    ]
}
```

### 캐릭터 데이터 (로스트아크 API)
```python
{
    'ServerName': '카마인',
    'CharacterName': '유우니유니',
    'CharacterLevel': 70,
    'CharacterClassName': '리퍼',
    'ItemAvgLevel': '1,670.83'
}
```

## 🚨 알림 예시

### 떠상 등장 알림
```
🚨 떠돌이 상인 등장 알림
떠돌이 상인이 등장했습니다! 현재 3명의 상인이 활성화되어 있습니다.

📍 유디아 - 루카스
🟢 모리나 • 🔵 천둥 • ⚪ 유디아 주술서
⚪ 유디아 천연소금

📍 루테란 서부 - 말론  
🟣 베르하트 • 🟠 카도건 • ⚪ 레이크바 토마토 주스
⚪ 사슬전쟁 실록 • ⚪ 머리초
```

### 원정대 정보 예시
```
👥 유우니유니의 원정대
카마인 서버 | 총 25명의 캐릭터

🏠 카마인 서버 (25명)
1. ⭐ 유우니유니
   📋 리퍼 | 🎯 Lv.70 | ⚔️ 1,670.83

2. 하나츄릅
   📋 건슬링어 | 🎯 Lv.70 | ⚔️ 1,655.00

📊 원정대 통계
최고 아이템레벨: 1,670.8
평균 아이템레벨: 1,015.6
총 캐릭터 수: 25명
```

## 🌐 다중 서버 지원

### 서버별 독립 운영
- **A서버**: #떠상-알림 채널에 알림
- **B서버**: #일반 채널에 알림  
- **C서버**: #공지 채널에 알림

### 명령어 사용
- **어느 채널에서든**: 모든 명령어 사용 가능
- **응답**: 요청한 채널에만 답변
- **자동 알림**: 설정된 알림 채널에만 전송

## 🔄 업데이트 내역

### v2.0.0 (최신)
- ✅ 다중 서버 지원 추가
- ✅ 로스트아크 캐릭터 정보 조회 기능
- ✅ 원정대 정보 조회 기능 (서버별 그룹핑)
- ✅ 스마트 알림 시스템 (데이터 변경시에만)
- ✅ 슬래시 명령어 전환
- ✅ 서버별 알림 채널 설정 기능

### v1.0.0
- ✅ 기본 떠상 알림 기능
- ✅ Selenium 기반 데이터 수집
- ✅ 니나브 서버 전용

## 🤝 기여하기

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📝 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## 📞 문의

프로젝트 관련 문의사항이 있으시면 GitHub Issues를 이용해주세요.

---

**⚠️ 주의사항**
- 로스트아크 API 사용시 공식 API 정책을 준수해주세요
- 과도한 요청으로 인한 차단에 주의하세요
- 봇 토큰과 API 키는 안전하게 관리해주세요

**🎯 권장 사용법**
- 메인 봇: `integrated_lostark_bot.py` 사용 권장
- 다중 서버 운영시 각 서버별로 알림 채널 설정
- 관리자 권한으로 알림 채널 관리
