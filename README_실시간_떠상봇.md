# 🚨 실시간 떠돌이 상인 알림봇

## ✨ 핵심 기능

### 🔔 자동 실시간 알림
- **새로운 떠돌이 상인 등장시** 즉시 Discord 알림
- **마감 30분 전** 알림으로 놓치지 않게 도움
- **판매 아이템 목록**과 **정확한 마감시간** 표시

### 📊 제공 정보
- 상인 이름 및 위치
- 마감 시간 (정확한 시:분:초)
- 판매 아이템 (등급별 이모지 표시)
- 남은 시간 실시간 계산

## 🎮 Discord 명령어

### 실시간 떠돌이 상인 관련
```
!현재떠상     - 현재 활성화된 떠돌이 상인 조회
!떠상알림     - 수동으로 떠상 변경사항 확인
```

### 기존 상인 정보 관련
```
!상인목록     - 전체 상인 목록 조회
!스케줄      - 오늘의 상인 스케줄 조회
!상인정보 벤  - 특정 상인 상세 정보
!아이템검색 카마인 - 아이템을 파는 상인 찾기
!도움말      - 명령어 도움말
```

## 📱 알림 예시

### 🚨 새로운 상인 등장 알림
```
🚨 새로운 떠돌이 상인 등장! 🚨
===================================

📍 아르테미스 - 벤
⏰ 마감시간: 15:30:45
🛍️ 주요 아이템:
  • 🟣 카마인 (영웅 카드)
  • 🟣 두근두근 상자 (영웅 아이템)
  • 🔵 아르테미스 성수 (희귀 아이템)
```

### ⚠️ 마감 임박 알림
```
⚠️ 마감 임박 상인 알림 ⚠️
==============================

📍 아르테미스 - 벤
⏰ 남은 시간: 25분
🔚 마감시간: 15:30:45
```

### 🏪 현재 활성 상인 조회
```
🏪 현재 활성 상인 (2명) 🏪
==============================

📍 아르테미스 - 벤
⏰ 남은 시간: 1시간 25분
🛍️ 🟣 카마인

📍 유디아 - 루카스
⏰ 남은 시간: 45분
🛍️ 🟣 하늘을 비추는 기름
```

## 🔧 설정 방법

### 1. 파일 구성 확인
```
디스코드봇/
├── 니나브_떠상봇.py (메인 봇 - 업데이트됨)
├── merchant_parser.py (상인 정보 파서)
├── wandering_merchant_tracker.py (실시간 추적기 - 새로 추가)
└── test_active_merchant.py (테스트 파일)
```

### 2. 봇 실행
1. `니나브_떠상봇.py` 실행
2. Discord 봇 토큰과 채널 ID 입력
3. 모니터링 간격 설정 (권장: 30초)
4. "봇 시작" 버튼 클릭

### 3. 자동 모니터링 시작
- 봇이 자동으로 30초마다 떠돌이 상인 상태 확인
- 새로운 상인 등장시 즉시 알림
- 마감 30분 전 자동 알림

## 🎯 주요 개선사항

### ✅ 이전 버전 대비 개선점
- **실시간 추적**: 단순 데이터 변경 감지 → 실시간 상인 상태 추적
- **정확한 시간**: 마감시간을 정확히 계산하여 표시
- **스마트 알림**: 새로운 상인과 마감 임박 상인 구분 알림
- **효율적 모니터링**: 불필요한 알림 최소화

### 🔍 알림 조건
1. **새로운 상인 등장**: 이전에 없던 상인이 활성화될 때
2. **마감 30분 전**: 활성 상인의 마감이 30분 이내로 다가올 때
3. **상인 마감**: 상인이 비활성화될 때 (로그만, Discord 알림 X)

## 🛠️ 고급 설정

### 모니터링 간격 조정
- **10-30초**: 실시간성 중시 (서버 부하 증가)
- **30-60초**: 균형잡힌 설정 (권장)
- **60-300초**: 서버 부하 최소화

### 알림 채널 설정
- 전용 떠돌이 상인 알림 채널 생성 권장
- 봇에게 해당 채널 읽기/쓰기 권한 부여 필요

## 🐛 문제 해결

### 자주 발생하는 문제
1. **"wandering_merchant_tracker 모듈을 찾을 수 없음"**
   - 모든 파일이 같은 폴더에 있는지 확인

2. **알림이 오지 않음**
   - API 연결 상태 확인 ("API 테스트" 버튼 사용)
   - 봇 권한 확인 (채널 읽기/쓰기 권한)

3. **시간이 맞지 않음**
   - 시스템 시간 확인
   - 시간대 설정 확인

### 로그 확인
GUI 하단 로그창에서 실시간 상태 확인:
- `새로운 상인 X명 등장!` - 새 상인 감지
- `마감 임박 상인 X명` - 마감 임박 알림
- `떠돌이 상인 변경사항 없음` - 정상 모니터링 중

## 📈 사용 팁

### 효과적인 활용법
1. **전용 채널 생성**: `#떠돌이상인알림` 채널 생성
2. **역할 멘션**: 특정 역할에게만 알림 (봇 코드 수정 필요)
3. **모바일 알림**: Discord 모바일 앱 알림 설정
4. **즐겨찾기**: 원하는 아이템을 파는 상인 체크

### 명령어 활용
- 게임 시작 전: `!현재떠상`으로 현재 상황 확인
- 의심스러울 때: `!떠상알림`으로 수동 확인
- 특정 아이템 필요시: `!아이템검색 아이템명`

---

**🎉 이제 떠돌이 상인을 놓칠 일이 없습니다!**

봇이 24시간 자동으로 모니터링하여 새로운 상인 등장과 마감 임박을 실시간으로 알려드립니다.
